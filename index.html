<!doctype html>
<html>
<head>
  <title>WalkerBoard</title>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootswatch/3.0.3/cyborg/bootstrap.min.css">
  <link rel="stylesheet" href="css/WalkerBoard.css"></head>
<body>
<div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <a class="navbar-brand" href="#" id="title">loading dashboard...</a>
      <p class="navbar-text">powered by WalkerBoard</p>
    </div>
    <form class="navbar-form navbar-right" role="form" id="loadform">
      <div class="form-group">
        <input type="text" id="boardfile" placeholder="path to board file" class="form-control">
      </div>
      <button type="submit" class="btn btn-primary">Load Board</button>
    </form>
  </div>
</div>
<div id="error" class="jumbotron">
  <h1>Failed to Load Dashboard!</h1>
  <p>please check the board URL</p>
</div>
<div class="container" id="panels"></div>
<!-- Facebook's React.js -->
<script src="lib/react.min.js"></script>
<script src="js/panel.js"></script>
<script src="js/widgets.js"></script>
<script type="text/javascript">
(function(){
  //load board.
  var boardfile = window.location.hash.replace(/^#/, "");
  if(!boardfile){
    boardfile = "board.json";
  }else{
    boardfile = decodeURIComponent(boardfile);
  }
  document.getElementById("boardfile").value = boardfile;
  var xhr = new XMLHttpRequest();
  var error = function(){
    document.getElementById("error").classList.add("visible");
  }
  xhr.open("GET", boardfile, true);
  xhr.addEventListener("load", function(){
    if(xhr.status == 200){
      try {
        var board = JSON.parse(xhr.responseText);
        if(!Array.isArray(board.Panels)){
          throw new Error();
        }
        if(!board.Title){
          board.Title = boardfile;
        }
        window.setTimeout(function(){
          document.getElementById("title").innerText = board.Title;
          React.renderComponent(Board(board), document.getElementById("panels"));
        }, 4);
      }catch(e){
        error();
      }
    }else{
      error();
    }
  });
  xhr.addEventListener("error", error);
  xhr.send(null);

  //bind form to load
  document.getElementById("loadform").addEventListener("submit", function(ev){
    ev.preventDefault();
    window.location.hash = encodeURIComponent(document.getElementById("boardfile").value);
    window.location.reload();
  })
})();
</script>
</body>
</html>